<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Agenda Medicina - Turma H</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#007bff">

    <style>
        :root { --p-med: #007bff; --bg: #f4f7f6; --card-bg: #1e1e1e; --text-color: #e0e0e0; --shadow: rgba(0,0,0,0.5); --input-bg: #2d2d2d; }
        [data-theme="light"] { --bg: #f4f7f6; --card-bg: #ffffff; --text-color: #333333; --shadow: rgba(0,0,0,0.1); --input-bg: #eeeeee; }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--text-color); transition: background 0.3s; padding-bottom: 60px; overscroll-behavior-y: contain; }

        #refresh-indicator { position: fixed; top: -60px; left: 50%; transform: translateX(-50%); background: var(--p-med); color: white; padding: 10px 25px; border-radius: 30px; font-size: 14px; font-weight: bold; z-index: 10001; transition: top 0.3s; box-shadow: 0 4px 15px var(--shadow); }

        /* --- ESTILOS DA GRADE --- */
        .grade-item { display: flex; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--shadow); align-items: flex-start; }
        .grade-hora { flex: 0 0 75px; font-size: 0.8em; font-weight: 800; color: var(--p-med); text-align: right; }
        .grade-info { flex: 1; text-align: left; }
        .grade-materia { font-weight: bold; font-size: 0.95em; display: block; color: var(--text-color); }

        #splash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffffff; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; transition: opacity 0.8s; }
        
        .header { text-align: center; margin-bottom: 20px; }
        #status-bar { font-size: 0.8em; color: #888; margin-top: 5px; }
        
        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { background: var(--card-bg); height: 110px; border-radius: 15px; box-shadow: 0 4px 6px var(--shadow); cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: 600; }
        .card .icon { font-size: 1.8em; margin-bottom: 8px; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; padding: 15px; z-index: 2000; backdrop-filter: blur(4px); }
        .modal-content { background: var(--card-bg); padding: 20px; border-radius: 20px; width: 100%; max-width: 400px; max-height: 85vh; overflow-y: auto; position: relative; }
        .close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; color: var(--text-color); }
        
        /* RetrÃ¡teis */
        .secao-retratil { margin-bottom: 10px; border-radius: 12px; background: rgba(255,255,255,0.03); border: 1px solid var(--shadow); overflow: hidden; }
        .secao-titulo { background: rgba(0,123,255,0.1); color: var(--p-med); padding: 12px 15px; font-weight: 800; font-size: 0.8em; text-transform: uppercase; cursor: pointer; display: flex; justify-content: space-between; }

        .arquivo-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--input-bg); border-radius: 10px; margin-bottom: 8px; text-decoration: none; color: var(--text-color); }
        
        #theme-toggle { position: fixed; bottom: 25px; right: 25px; background: var(--card-bg); border: 2px solid var(--p-med); border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; z-index: 999; }
        .footer-creditos { text-align: center; font-size: 11px; color: #888; margin-top: 50px; padding-bottom: 20px; cursor: pointer; }
    </style>
</head>
<body data-theme="dark">

<div id="refresh-indicator">ðŸ”„ Atualizando...</div>
<button id="theme-toggle" onclick="toggleTheme()"><span id="theme-icon">ðŸŒ™</span></button>

<div id="splash">
    <h2 style="color:#007bff">Medicina - UCP</h2>
</div>

<div class="header">
    <h2 style="margin:0;">Medicina - Turma H</h2>
    <div id="status-bar">Carregando...</div>
</div>

<div class="grid-container">
    <div class="card" onclick="abrirGrade()"><span class="icon">ðŸ“…</span><span>Grade</span></div>
    <div class="card" onclick="abrirGrupos()"><span class="icon">ðŸ‘¥</span><span>Grupos</span></div>
    <div class="card" onclick="mostrarAba('Avisos')"><span class="icon">ðŸ””</span><span>Avisos</span></div>
    <div class="card" onclick="abrirArquivos()"><span class="icon">ðŸ“„</span><span>Arquivos</span></div>
    <div class="card" onclick="mostrarAba('Links')" style="grid-column: span 2; height: 80px; flex-direction: row; gap: 15px;">
        <span class="icon">ðŸ’»</span><span>Aulas Online</span>
    </div>
</div>

<div id="meuModal" class="modal">
    <div class="modal-content">
        <button class="close-btn" onclick="fecharModal()">âœ•</button>
        <h3 id="modal-titulo" style="margin-bottom:20px; color:var(--p-med);"></h3>
        <div id="modal-corpo"></div>
    </div>
</div>

<div id="modalAdmin" class="modal">
    <div class="modal-content">
        <button class="close-btn" onclick="fecharAdmin()">âœ•</button>
        <h3 style="color:#28a745;">Painel do Representante</h3>
        <p>Funcionalidade em desenvolvimento via Google Sheets.</p>
    </div>
</div>

<div class="footer-creditos" id="btnAdmin">Desenvolvido por JoÃ£o Vitor FrÃ³is Sanchez</div>

<script>
// --- Copiar link da planilha ---
    const URL_API = "https://script.google.com/macros/s/AKfycbxDt1R5Gpu2aDY5dts6aDQcigKLx28ZxjmXynrvOvmGmvwaG86xBQmOABbn_BsKsUNP7A/exec";
    let dadosApp = {};
    let timerAdmin;

    // --- ACESSO ADMIN (Segurar 5 segundos) ---
    const btnAdmin = document.getElementById('btnAdmin');
    btnAdmin.addEventListener('mousedown', startTimer);
    btnAdmin.addEventListener('touchstart', startTimer);
    btnAdmin.addEventListener('mouseup', clearTimer);
    btnAdmin.addEventListener('touchend', clearTimer);

    function startTimer() { timerAdmin = setTimeout(() => { document.getElementById('modalAdmin').style.display = 'flex'; }, 5000); }
    function clearTimer() { clearTimeout(timerAdmin); }
    function fecharAdmin() { document.getElementById('modalAdmin').style.display = 'none'; }

    // --- CARREGAMENTO ---
    async function carregarDados() {
        try {
            const res = await fetch(`${URL_API}?t=${new Date().getTime()}`);
            dadosApp = await res.json();
            localStorage.setItem('cache_h', JSON.stringify(dadosApp));
            document.getElementById('status-bar').innerText = `Atualizado: ${dadosApp.ultima_sincronizacao || 'Agora'}`;
        } catch (e) {
            dadosApp = JSON.parse(localStorage.getItem('cache_h') || "{}");
            document.getElementById('status-bar').innerText = "Modo Offline";
        }
    }

    // --- LÃ“GICA DA GRADE (POR DIA DA SEMANA) ---
    function abrirGrade() {
        const corpo = document.getElementById('modal-corpo');
        document.getElementById('modal-titulo').innerText = "Grade de Aulas";
        corpo.innerHTML = "";
        
        const ordemDias = ["Segunda", "TerÃ§a", "Quarta", "Quinta", "Sexta", "SÃ¡bado"];
        const itens = dadosApp["Grade"] || [];
        
        ordemDias.forEach(dia => {
            const aulasDia = itens.filter(a => a["Dia da Semana"] === dia);
            if(aulasDia.length > 0) {
                let htmlAulas = aulasDia.map(aula => `
                    <div class="grade-item">
                        <div class="grade-hora">${aula.HorÃ¡rios || '---'}</div>
                        <div class="grade-info">
                            <b class="grade-materia">${aula.MatÃ©ria}</b>
                            <small>${aula.Grupo || 'Turma H'}</small>
                        </div>
                    </div>
                `).join('');
                corpo.innerHTML += `<details class="secao-retratil"><summary class="secao-titulo">${dia} <span>â–¼</span></summary><div style="padding:0 15px;">${htmlAulas}</div></details>`;
            }
        });
        document.getElementById('meuModal').style.display = 'flex';
    }

    // --- LÃ“GICA DE ARQUIVOS (POR MATÃ‰RIA) ---
    function abrirArquivos() {
        const corpo = document.getElementById('modal-corpo');
        document.getElementById('modal-titulo').innerText = "Arquivos";
        corpo.innerHTML = "";
        
        const itens = dadosApp["Arquivos"] || [];
        const categorias = [...new Set(itens.map(i => i.Nome))];

        categorias.forEach(cat => {
            const arqs = itens.filter(i => i.Nome === cat);
            let htmlArqs = arqs.map(arq => `
                <a href="${arq.Link}" target="_blank" class="arquivo-item">
                    <span>${arq.DescriÃ§Ã£o || 'Ver Arquivo'}</span>
                    <span>ðŸ”—</span>
                </a>
            `).join('');
            corpo.innerHTML += `<details class="secao-retratil"><summary class="secao-titulo">${cat} <span>â–¼</span></summary><div style="padding:10px;">${htmlArqs}</div></details>`;
        });
        document.getElementById('meuModal').style.display = 'flex';
    }

    // --- LÃ“GICA DE GRUPOS (RECOLHIDOS) ---
    function abrirGrupos() {
        const corpo = document.getElementById('modal-corpo');
        document.getElementById('modal-titulo').innerText = "Grupos";
        corpo.innerHTML = "";
        
        const itens = dadosApp["Grupos"] || [];
        const materias = [...new Set(itens.map(i => i["MatÃ©ria"]))];

        materias.forEach(mat => {
            const gruposMat = itens.filter(i => i["MatÃ©ria"] === mat);
            const nomesGrupos = [...new Set(gruposMat.map(g => g["Nome do Grupo"]))];

            let htmlGrupos = nomesGrupos.map(nomeG => {
                const integrantes = gruposMat.filter(g => g["Nome do Grupo"] === nomeG).map(i => `<li>${i.Integrantes}</li>`).join('');
                return `<details style="margin:5px 0; border:1px solid #444; border-radius:8px;">
                            <summary style="padding:8px; cursor:pointer;">${nomeG}</summary>
                            <ul style="padding-bottom:10px; font-size:0.9em;">${integrantes}</ul>
                        </details>`;
            }).join('');

            corpo.innerHTML += `<details class="secao-retratil"><summary class="secao-titulo">${mat} <span>â–¼</span></summary><div style="padding:10px;">${htmlGrupos}</div></details>`;
        });
        document.getElementById('meuModal').style.display = 'flex';
    }

    function mostrarAba(aba) {
        const corpo = document.getElementById('modal-corpo');
        document.getElementById('modal-titulo').innerText = aba;
        const itens = dadosApp[aba] || [];
        corpo.innerHTML = itens.map(i => `<div class="arquivo-item"><b>${i.Materia || i.Titulo}</b><br>${i.Data || i.Mensagem}</div>`).join('');
        document.getElementById('meuModal').style.display = 'flex';
    }

    function fecharModal() { document.getElementById('meuModal').style.display = 'none'; }
    
    function toggleTheme() {
        const body = document.body;
        const novoTema = body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        body.setAttribute('data-theme', novoTema);
        document.getElementById('theme-icon').innerText = novoTema === 'dark' ? 'ðŸŒ™' : 'ðŸ’¡';
    }

    window.onload = () => {
        carregarDados();
        setTimeout(() => { document.getElementById('splash').style.opacity = '0'; setTimeout(()=>document.getElementById('splash').style.display='none', 800); }, 1500);
    };
</script>
</body>
</html>

